---
title: "Regression Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(corrplot)
library(ggpubr)
```

```{r, include = FALSE}
# tidy data
regression_data = read_csv("../data/us_2017.csv") %>%
  janitor::clean_names() %>% 
  filter(state != "District of Columbia") %>% 
  mutate(
    suicide = suicide_rate,
    gun = guns_number_per_capita_average,
    alcohol = alcohol_consumption,
    marijuana = marijuana_usage * 100,
    education = (advanced_degree + bachelors_degree) * 100,
    gender = male_proportion * 100
    ) %>% 
  select(state, suicide, gun, alcohol, temperature, precipitation, marijuana, education, gdp, gender) %>% 
  # replace missing value with mean value
  mutate(
    gun = replace_na(gun, mean(gun, na.rm = TRUE)),
    temperature = replace_na(temperature, mean(temperature, na.rm = TRUE)))

write_csv(regression_data,"./regression_data.csv")
```

## Method

Data from several sources were joined together into a merged dataset. We used 2017 year to build the model. Main outcome is suicide rate for each state, candidate predictors are gun, alchohol, temperature, precipitation, marijuana, education, gdp and gender for each state. We used stepwise approach to select model. 

| Predictor  | Description   |
| :------------------: | :----------------------------------------------------------------------------------: |
| suicide  | Suicide rate per 100000 population  |
| gun  | Number of guns per 1000 population  |
| alcohol  | Alcohol consumption per capita (gallons of ethanol)|
| temperature  | Average temperature (F)     |
| precipitation |  Average precipitation (inches) |                         
| marijuana  | Marijuana use in adults (%)
| education    | Educational attainment - bachelor's degree or higher (%)   |
| gdp    | GDP per capita (dollars)   |
| gender    | Male (%)   |

## Results

### Scatter Plot

```{r, echo = FALSE}
# gun
gun_plot = 
  regression_data %>% 
  ggplot(aes(x = gun, y = suicide)) +
  geom_point() 
# + labs(x = "Number of guns per 1000 population", y = "Suicide rate per 100000 population")

# alcohol
alcohol_plot =
  regression_data %>% 
  ggplot(aes(x = alcohol, y = suicide)) +
  geom_point() 
# + labs(x = "Alcohol consumption per capita (gallons of ethanol)", y = "Suicide rate per 100000 population")

# temperature
temp_plot =
  regression_data %>% 
  ggplot(aes(x = temperature, y = suicide)) +
  geom_point() 
# + labs(x = "Average temperature (F)", y = "Suicide rate per 100000 population")

temp_ly = ggplotly(temp_plot)

# precipitation
precip_plot =
  regression_data %>% 
  ggplot(aes(x = precipitation, y = suicide)) +
  geom_point() 
# + labs(x = "Average precipitation (inches)", y = "Suicide rate per 100000 population")

# marijuana
mari_plot =
  regression_data %>% 
  ggplot(aes(x = marijuana, y = suicide)) +
  geom_point() 
# + labs(x = "Marijuana use in adults (%)", y = "Suicide rate per 100000 population")

# education
edu_plot =
  regression_data %>% 
  ggplot(aes(x = education, y = suicide)) +
  geom_point() 
# + labs(x = "Educational attainment - bachelor's degree or higher (%) ",y = "Suicide rate per 100000 population")

# gdp
gdp_plot =
  regression_data %>% 
  ggplot(aes(x = gdp, y = suicide)) +
  geom_point() 
# + labs(x = "GDP per capita (dollars)", y = "Suicide rate per 100000 population")

# gender
gender_plot = 
  regression_data %>% 
  ggplot(aes(x = gender, y = suicide)) +
  geom_point() 
# + labs(x = "Male (%)", y = "Suicide rate per 100000 population")
                      
ggarrange(gun_plot, alcohol_plot, temp_plot, precip_plot, mari_plot, edu_plot, gdp_plot, gender_plot, nrow = 3, ncol = 3) 
```  

### Correlation plot

```{r, echo = FALSE}
regression_data %>% 
  select(-state) %>% 
  cor() %>% 
  corrplot(
    tl.col = "black", 
    tl.cex = .8, 
    addCoef.col = "black",
    order = c("original"),
    method = "color",
    number.cex = .7)
```

### Selected model of interest

```{r, include = FALSE}
fit1 = lm(suicide ~.-state,data = regression_data)
summary(fit1)
step(fit1)
```

```{r, echo = FALSE}
fit2 = lm(suicide ~ gun + temperature + marijuana + education + gender +gdp, data = regression_data)
fit2 %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  knitr::kable(digits = 4)

fit2 %>% 
  broom::glance() %>% 
  select(r.squared, adj.r.squared, AIC, BIC) %>% 
  knitr::kable(digits = 4)
```

The fitted equation is "suicide = -143.99 + 0.12gun - 0.10temperature + 0.25marijuana - 0.23education + 3.56gender - 0.0002gdp". As the regression shows, "gun", "marijuana","education","gender","gdp" are significant predictors for suicide rate. Adjusted R-square is 0.8124, which means these variables can explain a large proportion of variance in the suicide rate. According to the results, suicide rate is larger in states where have a higher gun ownership rate, higher marijuana usage, higher ratio of males to females, lower temperature and lower educational attainment.   




